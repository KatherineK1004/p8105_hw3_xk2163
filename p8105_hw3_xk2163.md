P8105_HW3_xk2163
================
Kang
2024-10-16

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

# Problem 2

``` r
data_q2_1_df = 
  read_csv("data/nhanes_accel.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = starts_with("min"),
    names_to = "time_minutes",
    values_to = "values") |> 
  separate(col = time_minutes,
           into = c("min","time_minutes"),
           sep = "min") |> 
  select(-min) |> 
  mutate(time_minutes = as.numeric(time_minutes))
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
data_q2_2_df = 
  read_csv("data/nhanes_covar.csv",skip = 4) |> 
  janitor::clean_names() |> 
  mutate(
    sex = factor(case_match(sex,
                     1 ~ "male",
                     2 ~ "female")),
    education = factor(case_match(education,
                           1~"Less_than_high_school",
                           2~"High_school_equivalent",
                           3~ "More_than_high_school"))
    ) |> 
  filter(age>=21) |> 
  drop_na()
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

# Female and Male

``` r
data_q2_df = left_join(data_q2_2_df,data_q2_1_df,by = "seqn")

data_summary_q2 = 
  data_q2_2_df |>
  group_by(sex) |> 
  summarize(numbers = n()) |> 
  as_tibble()

 data_summary_q2 |> 
   knitr::kable(
    caption = "Number of Individuals",
    col.names = c("Sex", "Number"),
    format = "html",
    align = c("l", "c"))
```

<table>
<caption>
Number of Individuals
</caption>
<thead>
<tr>
<th style="text-align:left;">
Sex
</th>
<th style="text-align:center;">
Number
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
female
</td>
<td style="text-align:center;">
110
</td>
</tr>
<tr>
<td style="text-align:left;">
male
</td>
<td style="text-align:center;">
118
</td>
</tr>
</tbody>
</table>

``` r
ggplot(data_summary_q2, 
       aes(y = numbers, x = sex)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Number of Individuals by Sex",
    x = "Sex",
    y = "Number of Individuals") +
  theme_classic() 
```

![](p8105_hw3_xk2163_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

``` r
data_q2_summary2 = 
  data_q2_df |> 
  group_by(seqn, sex, age, bmi, education) |> 
  summarize(activity_level = sum(values), .groups = "drop")

ggplot(data_q2_summary2, aes(x = age, y = activity_level, color = sex)) +
  geom_point(alpha = 0.6) +  
  geom_smooth(method = "loess", se = FALSE) +  
  facet_wrap(~ education) +  
  labs(
    title = "Total Activity vs. Age by Sex and Education",
    x = "Age",
    y = "Total Activity",
    color = "Sex"
  ) +
  theme_minimal()
```

    ## `geom_smooth()` using formula = 'y ~ x'

![](p8105_hw3_xk2163_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

``` r
ggplot(data_q2_df, aes(x = time_minutes, y = values, color = sex)) +
  geom_line(alpha = 0.4) +  
  geom_smooth(method = "loess", se = FALSE, linetype = "dashed", size = 1) +
  facet_wrap(~ education, scales = "free_y") +  
  labs(
    title = "24-Hour Activity Time Course by Education Level",
    x = "Minutes of the Day",
    y = "Activity Level",
    color = "Sex"
  ) +
  theme_minimal()
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## ℹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

    ## `geom_smooth()` using formula = 'y ~ x'

![](p8105_hw3_xk2163_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

# Problem 3

``` r
file_path = "data/citibike/"

file_name = 
  list.files(file_path, 
             pattern = "\\.csv$", 
             full.names = TRUE)

read_and_label =
  function(file) {
  data = read.csv(file)
  
  file_info = strsplit(basename(file), " ")[[1]]
  month = file_info[1]
  year = file_info[2]
  
  data = 
    data |> 
    mutate(year = year,
           month = month)
  
  return(data)
  }

data_q3_df =
  lapply(file_name, read_and_label) |> 
  bind_rows() |> 
  mutate(rideable_type = factor(rideable_type),
         member_casual = factor(member_casual))
```

``` r
data3_summary =
  data_q3_df |> 
  group_by(year, month, member_casual) |> 
  summarize(total_rides = n()) |> 
  arrange(year, month, member_casual)
```

    ## `summarise()` has grouped output by 'year', 'month'. You can override using the
    ## `.groups` argument.

``` r
data3_summary |> 
  knitr::kable(caption = "Total Number of Rides",
    col.names = c("Year", "Month", "Rider Type", "Total Rides"),
    format = "html")
```

<table>
<caption>
Total Number of Rides
</caption>
<thead>
<tr>
<th style="text-align:left;">
Year
</th>
<th style="text-align:left;">
Month
</th>
<th style="text-align:left;">
Rider Type
</th>
<th style="text-align:right;">
Total Rides
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
Jan
</td>
<td style="text-align:left;">
casual
</td>
<td style="text-align:right;">
984
</td>
</tr>
<tr>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
Jan
</td>
<td style="text-align:left;">
member
</td>
<td style="text-align:right;">
11436
</td>
</tr>
<tr>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
July
</td>
<td style="text-align:left;">
casual
</td>
<td style="text-align:right;">
5637
</td>
</tr>
<tr>
<td style="text-align:left;">
2020
</td>
<td style="text-align:left;">
July
</td>
<td style="text-align:left;">
member
</td>
<td style="text-align:right;">
15411
</td>
</tr>
<tr>
<td style="text-align:left;">
2024
</td>
<td style="text-align:left;">
Jan
</td>
<td style="text-align:left;">
casual
</td>
<td style="text-align:right;">
2108
</td>
</tr>
<tr>
<td style="text-align:left;">
2024
</td>
<td style="text-align:left;">
Jan
</td>
<td style="text-align:left;">
member
</td>
<td style="text-align:right;">
16753
</td>
</tr>
<tr>
<td style="text-align:left;">
2024
</td>
<td style="text-align:left;">
July
</td>
<td style="text-align:left;">
casual
</td>
<td style="text-align:right;">
10894
</td>
</tr>
<tr>
<td style="text-align:left;">
2024
</td>
<td style="text-align:left;">
July
</td>
<td style="text-align:left;">
member
</td>
<td style="text-align:right;">
36262
</td>
</tr>
</tbody>
</table>

``` r
data_q3_df |> 
  filter(year == "2024" & month == "July") |> 
  group_by(start_station_name) |> 
  summarize(total_rides = n())  |> 
  arrange(desc(total_rides)) |> 
  slice(1:5)  |> 
  knitr::kable(
    caption = "Top 5 Most Popular Starting Stations in July 2024",
    col.names = c("Station Name", "Number of Rides"),
    format = "html",
    align = c("l", "c"))
```

<table>
<caption>
Top 5 Most Popular Starting Stations in July 2024
</caption>
<thead>
<tr>
<th style="text-align:left;">
Station Name
</th>
<th style="text-align:center;">
Number of Rides
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Pier 61 at Chelsea Piers
</td>
<td style="text-align:center;">
163
</td>
</tr>
<tr>
<td style="text-align:left;">
University Pl & E 14 St
</td>
<td style="text-align:center;">
155
</td>
</tr>
<tr>
<td style="text-align:left;">
W 21 St & 6 Ave
</td>
<td style="text-align:center;">
152
</td>
</tr>
<tr>
<td style="text-align:left;">
West St & Chambers St
</td>
<td style="text-align:center;">
150
</td>
</tr>
<tr>
<td style="text-align:left;">
W 31 St & 7 Ave
</td>
<td style="text-align:center;">
146
</td>
</tr>
</tbody>
</table>

``` r
median_q3_df = 
  data_q3_df |> 
  group_by(year, month, weekdays) |> 
  summarize(median_duration = median(duration))
```

    ## `summarise()` has grouped output by 'year', 'month'. You can override using the
    ## `.groups` argument.

``` r
ggplot(median_q3_df, 
       aes(x = weekdays, y = median_duration, fill = weekdays)) +
  geom_bar(stat = "identity", 
           position = "dodge", 
           alpha = 0.8) +
  facet_grid(year ~ month) +
  labs(
    title = "Effects of Day of the Week, Month, and Year on Median Ride Duration",
    x = "Day of the Week",
    y = "Median Ride Duration (minutes)",
    fill = "Day of Week"
  ) +
  theme_minimal()
```

![](p8105_hw3_xk2163_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->

``` r
data_q3_2024 = 
  data_q3_df |> 
  filter(year == "2024")

ggplot(data_q3_2024, 
       aes(x = month, 
           y = duration, 
           fill = rideable_type)) +
  geom_boxplot(alpha = 0.6) + 
  facet_grid(member_casual ~ rideable_type) + 
  labs(
    title = "Impact of Different Features on Ride Duration (2024)",
    x = "Month",
    y = "Ride Duration (minutes, log scale)",
    fill = "Bike Type"
  ) +
  theme_minimal()
```

![](p8105_hw3_xk2163_files/figure-gfm/unnamed-chunk-12-1.png)<!-- -->
